<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú - ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ</title>
    
    <style>
        @font-face {
            font-family: 'Hind Siliguri';
            src: url('HindSiliguri-Regular.ttf') format('truetype');
            font-weight: normal; font-style: normal;
        }

        :root {
            --primary-green: #006a4e;
            --dark-green: #004d39;
            --bg-color: #f3f7f5;
            --white: #ffffff;
            --tab-color: rgba(255, 255, 255, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            background-color: var(--bg-color); 
            display: flex; flex-direction: column; min-height: 100vh;
            color: #1f2937;
            text-rendering: optimizeLegibility;
        }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        .fixed-header {
            position: fixed; top: 0; left: 0; right: 0; z-index: 100;
            background: var(--dark-green);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            color: var(--white);
            padding: 12px 16px;
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; width: 100%; }
        .brand { display: flex; align-items: center; gap: 10px; }
        .logo-img { width: 42px !important; height: 42px !important; min-width: 42px; object-fit: contain; }
        .brand h1 { font-size: 1.05rem; font-weight: 700; line-height: 1.2; }
        .brand p { font-size: 10px; opacity: 0.8; }

        .header-right { display: flex; align-items: center; gap: 8px; }
        .total-badge { background: var(--white); color: var(--dark-green); padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: 900; display: flex; align-items: center; gap: 3px; }
        
        .sync-btn { background: rgba(255,255,255,0.1); border: none; cursor: pointer; padding: 10px; border-radius: 50%; color: var(--white); display: flex; }
        .sync-btn svg { width: 18px !important; height: 18px !important; }

        /* ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶ï‡ßç‡¶∏ */
        .search-area { max-width: 1200px; margin: 12px auto 0; display: flex; background: var(--white); border-radius: 8px; overflow: hidden; position: relative; }
        .search-area select { border: none; background: #f0f0f0; padding: 0 10px; font-size: 12px; outline: none; width: 95px; font-weight: bold; cursor: pointer; }
        .search-area input { border: none; padding: 10px 40px 10px 12px; width: 100%; outline: none; font-size: 14px; }
        .clear-search { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: #eee; color: #777; width: 22px; height: 22px; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; }

        /* ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ */
        .tabs-container { display: flex; width: 100%; max-width: 1200px; margin: 12px auto 0; gap: 4px; }
        .category-tab { flex: 1; padding: 8px 2px; border-radius: 6px; cursor: pointer; font-size: 11px; color: #ffffff; white-space: nowrap; text-align: center; background: var(--tab-color); border: 1px solid rgba(255,255,255,0.1); transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .category-tab.active { background: var(--white) !important; color: var(--dark-green) !important; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .content-wrapper { padding: 220px 16px 30px; max-width: 1200px; margin: 0 auto; width: 100%; flex: 1; }
        @media (max-width: 768px) { .content-wrapper { padding-top: 245px; } }

        /* ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® */
        .voter-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 20px;
            will-change: transform; 
        }

        .voter-card { 
            background: var(--white); 
            border-radius: 12px; 
            border: 1px solid #e2e8f0; 
            overflow: hidden; 
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            contain: layout silver; 
        }
        
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .serial-box { background: var(--primary-green); color: var(--white); padding: 4px 15px; border-radius: 0 0 12px 0; font-weight: 700; }
        .id-badge { margin: 8px; font-size: 12px; font-weight: 800; color: #1e40af; background: #eff6ff; padding: 3px 10px; border-radius: 4px; border: 1px solid #dbeafe; }

        .card-body { padding: 15px; text-align: left; }
        .card-body h3 { font-size: 17px; color: var(--dark-green); border-bottom: 1px solid #f3f4f6; padding-bottom: 8px; margin-bottom: 10px; }
        .info-row { display: flex; gap: 8px; margin-bottom: 6px; font-size: 14px; }
        .info-label { color: #9ca3af; width: 45px; flex-shrink: 0; }
        .info-value { color: #374151; font-weight: 500; }

        .card-footer { margin-top: 12px; padding-top: 10px; border-top: 1px solid #f9fafb; display: flex; justify-content: space-between; align-items: center; font-size: 12px; }
        .date-icon { display: flex; align-items: center; gap: 5px; color: #6b7280; }
        .date-icon svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2; }
        .address-tag { background: #f0fdf4; color: #166534; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 11px; }

        .no-data-container { grid-column: 1 / -1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center; color: #9ca3af; }
        .no-data-container svg { width: 80px; height: 80px; margin-bottom: 15px; opacity: 0.3; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 25px; border-radius: 50px; font-size: 13px; z-index: 2000; opacity: 0; transition: 0.3s; pointer-events: none; }
        footer { padding: 20px; text-align: center; font-size: 11px; color: #9ca3af; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        mark { background: #fef08a; color: #854d0e; padding: 0 2px; border-radius: 2px; }
    </style>
</head>
<body>

    <div id="updatePopup" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: none; width: 90%; max-width: 400px;">
        <div style="background: white; border-left: 4px solid #22c55e; padding: 15px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px;">
            <div style="flex:1">
                <p style="font-weight:bold; font-size:14px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá!</p>
                <button onclick="syncData(true)" style="background: #16a34a; color: white; border: none; padding: 6px 15px; border-radius: 50px; font-weight: bold; font-size: 12px; cursor: pointer; margin-top: 5px;">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <header class="fixed-header">
        <div class="header-top">
            <div class="brand">
                <img src="logo.png" alt="Logo" class="logo-img">
                <div>
                    <h1>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ</h1>
                    <p>‡¶¶‡¶ï‡ßç‡¶∑‡¶ø‡¶£ ‡¶∂‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∂‡¶æ‡¶ñ‡¶æ, ‡¶Æ‡ßá‡¶π‡ßá‡¶∞‡¶™‡ßÅ‡¶∞</p>
                </div>
            </div>
            <div class="header-right">
                <button onclick="manualSync()" class="sync-btn">
                    <svg id="syncIcon" viewBox="0 0 24 24" stroke="currentColor" fill="none"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                </button>
                <div class="total-badge">
                    <span>‡¶Æ‡ßã‡¶ü:</span> <span id="totalDisplay">‡ß¶</span>
                </div>
            </div>
        </div>

        <div class="search-area">
            <select id="searchFilter">
                <option value="all">‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø</option>
                <option value="Name">‡¶®‡¶æ‡¶Æ</option>
                <option value="Serial">‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</option>
                <option value="Voter_No">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç</option>
            </select>
            <input type="text" id="searchInput" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." autocomplete="off">
            <div id="clearBtn" class="clear-search" onclick="clearSearch()">&times;</div>
        </div>

        <div class="tabs-container" id="tabs">
            <div class="category-tab active" data-source="all">‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø</div>
            <div class="category-tab" data-source="8p">‡ßÆ ‡¶®‡¶Ç ‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑</div>
            <div class="category-tab" data-source="8m">‡ßÆ ‡¶®‡¶Ç ‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ</div>
            <div class="category-tab" data-source="9p">‡ßØ ‡¶®‡¶Ç ‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑</div>
            <div class="category-tab" data-source="9m">‡ßØ ‡¶®‡¶Ç ‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ</div>
        </div>
    </header>

    <main class="content-wrapper">
        <div id="voterContainer" class="voter-grid"></div>
    </main>

    <div id="toast"></div>

    <footer>Developed by Sd Rubel</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        const baseUrl = 'https://raw.githubusercontent.com/sd-rubel/sd-election/main/';
        const files = { '8p': '8p.csv', '8m': '8m.csv', '9p': '9p.csv', '9m': '9m.csv' };
        
        let masterData = JSON.parse(localStorage.getItem('voterDB')) || { '8p': [], '8m': [], '9p': [], '9m': [] };
        let activeTab = 'all';
        let searchTimer;

        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
        window.onload = () => {
            renderData();
            setTimeout(checkUpdateAvailable, 2000);
            setupListeners();
        };

        function setupListeners() {
            const input = document.getElementById('searchInput');
            input.addEventListener('input', () => {
                clearTimeout(searchTimer);
                document.getElementById('clearBtn').style.display = input.value ? 'flex' : 'none';
                searchTimer = setTimeout(renderData, 100); // ‡ßß‡ß¶‡ß¶ ‡¶Æ‡¶ø‡¶≤‡¶ø-‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶°‡¶ø‡¶≤‡ßá ‡¶Ø‡¶æ ‡¶™‡¶æ‡¶∞‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶¨‡¶æ‡ßú‡¶æ‡¶¨‡ßá
            });

            document.getElementById('tabs').addEventListener('click', (e) => {
                if (e.target.classList.contains('category-tab')) {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    activeTab = e.target.dataset.source;
                    renderData();
                    window.scrollTo(0,0);
                }
            });
        }

        async function syncData(isManual = false) {
            const icon = document.getElementById('syncIcon');
            icon.style.animation = "spin 1s linear infinite";
            try {
                const results = await Promise.all(Object.entries(files).map(([key, file]) => 
                    new Promise(res => {
                        Papa.parse(`${baseUrl}${file}?t=${Date.now()}`, {
                            download: true, header: true, skipEmptyLines: true,
                            complete: (output) => res({ key, data: output.data.filter(i => i.Name) })
                        });
                    })
                ));
                results.forEach(r => masterData[r.key] = r.data);
                localStorage.setItem('voterDB', JSON.stringify(masterData));
                localStorage.setItem('dbId', Date.now());
                renderData();
                if(isManual) showToast("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!");
            } catch (e) { showToast("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            finally { icon.style.animation = ""; document.getElementById('updatePopup').style.display = 'none'; }
        }

        function renderData() {
            const container = document.getElementById('voterContainer');
            const search = document.getElementById('searchInput').value.trim();
            const filter = document.getElementById('searchFilter').value;
            
            let data = activeTab === 'all' ? Object.values(masterData).flat() : masterData[activeTab];

            if (search) {
                const s = search.toLowerCase();
                data = data.filter(v => {
                    if (filter === 'all') return (v.Name && v.Name.includes(search)) || (v.Voter_No && v.Voter_No.includes(search)) || (v.Serial && v.Serial.includes(search));
                    return v[filter] && v[filter].includes(search);
                });
            }

            document.getElementById('totalDisplay').innerText = data.length.toLocaleString('bn-BD');

            if (data.length === 0) {
                container.innerHTML = `<div class="no-data-container"><h2>‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</h2></div>`;
                return;
            }

            // ‡¶™‡¶æ‡¶∞‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø Batch Processing
            const limit = 100; // ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡ßß‡ß¶‡ß¶‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶Ø‡¶æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç ‡¶´‡¶æ‡¶∏‡ßç‡¶ü ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá
            const displayData = data.slice(0, limit);
            
            let html = '';
            for (let i = 0; i < displayData.length; i++) {
                const v = displayData[i];
                html += `
                    <div class="voter-card">
                        <div class="card-header">
                            <div class="serial-box">${v.Serial || '‡ß¶'}</div>
                            <div class="id-badge">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç: ${v.Voter_No}</div>
                        </div>
                        <div class="card-body">
                            <h3>${search ? v.Name.split(search).join('<mark>'+search+'</mark>') : v.Name}</h3>
                            <div class="info-row"><span class="info-label">‡¶™‡¶ø‡¶§‡¶æ:</span><span class="info-value">${v.Father_Name}</span></div>
                            <div class="info-row"><span class="info-label">‡¶Æ‡¶æ‡¶§‡¶æ:</span><span class="info-value">${v.Mother_Name}</span></div>
                            <div class="card-footer">
                                <span class="date-icon">üìÖ ${v.DOB}</span>
                                <span class="address-tag">üìç ${v.Address}</span>
                            </div>
                        </div>
                    </div>`;
            }
            container.innerHTML = html;
        }

        function clearSearch() {
            const input = document.getElementById('searchInput');
            input.value = '';
            document.getElementById('clearBtn').style.display = 'none';
            renderData();
            input.focus();
        }

        async function manualSync() {
            if (!navigator.onLine) return showToast("‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶®‡ßá‡¶á!");
            await syncData(true);
        }

        async function checkUpdateAvailable() {
            if (!navigator.onLine) return;
            try {
                const res = await fetch(baseUrl + '8p.csv?t=' + Date.now());
                if (res.ok) {
                    const freshId = res.headers.get('content-length');
                    if (localStorage.getItem('dbId') && freshId != localStorage.getItem('lastSize')) {
                        document.getElementById('updatePopup').style.display = 'block';
                        localStorage.setItem('lastSize', freshId);
                    }
                }
            } catch(e) {}
        }

        function showToast(m) {
            const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        }
    </script>
</body>
</html>